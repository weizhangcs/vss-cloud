# docker-compose.dev.yml
# 注意：version 字段已废弃（Docker Compose v1.27+）
# version: '1.2.0'

services:
  db:
    # [新增] 强制指向阿里云私有仓库
    image: crpi-34v4qt829vtet2cy.cn-hangzhou.personal.cr.aliyuncs.com/vss_base/postgres:16-alpine
    ports:
      - "8543:5432"

  # --- 覆盖 Redis 镜像源 ---
  redis:
    # [新增] 强制指向阿里云私有仓库
    image: crpi-34v4qt829vtet2cy.cn-hangzhou.personal.cr.aliyuncs.com/vss_base/redis:7-alpine
    restart: always
    ports:
      - "8637:6379"  # [新增] 左边是宿主机端口，右边是容器端口

  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8001
    volumes:
      - .:/app # [Dev] 挂载源码
      - ./shared_media:/app/shared_media
    ports:
      - "8001:8001"

  worker:
    build: .
    volumes:
      - .:/app # [Dev] 挂载源码
      - ./shared_media:/app/shared_media